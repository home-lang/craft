<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>My Web App</title>
    <style>
        :root {
            --primary: #007AFF;
            --background: #ffffff;
            --text: #1d1d1f;
            --secondary-text: #86868b;
            --border: #d2d2d7;
            --safe-area-top: env(safe-area-inset-top, 0px);
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background: #1d1d1f;
                --text: #f5f5f7;
                --secondary-text: #86868b;
                --border: #424245;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            padding-top: var(--safe-area-top);
            padding-bottom: var(--safe-area-bottom);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--secondary-text);
            font-size: 1.1rem;
        }

        .card {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 12px;
        }

        .card p {
            color: var(--secondary-text);
            line-height: 1.6;
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
            width: 100%;
            margin-top: 12px;
        }

        .button:hover {
            opacity: 0.9;
        }

        .button:active {
            opacity: 0.8;
        }

        .platform-info {
            background: var(--border);
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #e8f5e9;
            border-radius: 8px;
            margin-top: 16px;
        }

        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
        }

        @media (prefers-color-scheme: dark) {
            .status.success {
                background: #1b3d2b;
                color: #66bb6a;
            }
        }

        /* Native feature buttons */
        .native-features {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .feature-btn {
            padding: 16px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background 0.2s;
        }

        .feature-btn:hover {
            background: var(--border);
        }

        .feature-btn .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .feature-btn .label {
            font-size: 0.9rem;
            color: var(--text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>My Web App</h1>
            <p class="subtitle">Now running as a native app!</p>
        </header>

        <div class="card">
            <h2>Welcome</h2>
            <p>
                This is a web application that has been converted to a native app using the Craft framework.
                It runs in a native WebView with full access to system APIs.
            </p>
            <button class="button" onclick="showAlert()">Show Native Alert</button>
        </div>

        <div class="card">
            <h2>Platform Info</h2>
            <div class="platform-info" id="platform-info">
                Loading platform information...
            </div>
        </div>

        <div class="card">
            <h2>Native Features</h2>
            <p>Try these native integrations:</p>
            <div class="native-features">
                <button class="feature-btn" onclick="triggerHaptic()">
                    <div class="icon">ðŸ“³</div>
                    <div class="label">Haptic</div>
                </button>
                <button class="feature-btn" onclick="copyToClipboard()">
                    <div class="icon">ðŸ“‹</div>
                    <div class="label">Copy</div>
                </button>
                <button class="feature-btn" onclick="checkNetwork()">
                    <div class="icon">ðŸ“¶</div>
                    <div class="label">Network</div>
                </button>
                <button class="feature-btn" onclick="getSafeArea()">
                    <div class="icon">ðŸ“±</div>
                    <div class="label">Safe Area</div>
                </button>
            </div>
        </div>

        <div class="status success" id="status" style="display: none;">
            <span class="status-dot"></span>
            <span id="status-text">Ready</span>
        </div>
    </div>

    <script>
        // Craft Bridge - Communication between JS and Native
        const craft = {
            // Check if running in Craft native environment
            isNative: function() {
                return window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.craft;
            },

            // Send message to native code
            invoke: function(method, params = {}) {
                return new Promise((resolve, reject) => {
                    if (!this.isNative()) {
                        // Fallback for browser testing
                        console.log('Craft invoke (browser mode):', method, params);
                        resolve({ success: true, browser: true });
                        return;
                    }

                    const callbackId = Date.now().toString();

                    // Register callback
                    window['__craftCallback_' + callbackId] = function(result) {
                        delete window['__craftCallback_' + callbackId];
                        resolve(result);
                    };

                    // Send to native
                    window.webkit.messageHandlers.craft.postMessage({
                        method: method,
                        params: params,
                        callbackId: callbackId
                    });

                    // Timeout after 10 seconds
                    setTimeout(() => {
                        if (window['__craftCallback_' + callbackId]) {
                            delete window['__craftCallback_' + callbackId];
                            reject(new Error('Timeout'));
                        }
                    }, 10000);
                });
            }
        };

        // Get platform info on load
        async function getPlatformInfo() {
            const info = document.getElementById('platform-info');

            try {
                const platform = await craft.invoke('getPlatform');
                info.innerHTML = `
                    <strong>Platform:</strong> ${platform.os || 'Unknown'}<br>
                    <strong>Version:</strong> ${platform.version || 'N/A'}<br>
                    <strong>Device:</strong> ${platform.device || 'N/A'}<br>
                    <strong>Native:</strong> ${craft.isNative() ? 'Yes' : 'No (Browser)'}
                `;
            } catch (e) {
                info.innerHTML = `
                    <strong>Platform:</strong> ${navigator.platform}<br>
                    <strong>User Agent:</strong> ${navigator.userAgent.slice(0, 50)}...<br>
                    <strong>Native:</strong> ${craft.isNative() ? 'Yes' : 'No (Browser)'}
                `;
            }
        }

        // Show native alert
        async function showAlert() {
            showStatus('Showing alert...');

            try {
                await craft.invoke('showAlert', {
                    title: 'Hello!',
                    message: 'This is a native alert dialog.',
                    buttons: ['OK']
                });
                showStatus('Alert shown!');
            } catch (e) {
                // Fallback to browser alert
                alert('Hello! This is a native alert dialog.');
                showStatus('Alert shown (browser)');
            }
        }

        // Trigger haptic feedback
        async function triggerHaptic() {
            showStatus('Triggering haptic...');

            try {
                await craft.invoke('haptic', { type: 'success' });
                showStatus('Haptic triggered!');
            } catch (e) {
                showStatus('Haptic not available');
            }
        }

        // Copy to clipboard
        async function copyToClipboard() {
            const text = 'Hello from Craft! ðŸš€';
            showStatus('Copying to clipboard...');

            try {
                await craft.invoke('setClipboard', { text: text });
                showStatus('Copied: ' + text);
            } catch (e) {
                // Fallback to browser clipboard API
                await navigator.clipboard.writeText(text);
                showStatus('Copied (browser): ' + text);
            }
        }

        // Check network status
        async function checkNetwork() {
            showStatus('Checking network...');

            try {
                const status = await craft.invoke('getNetworkStatus');
                showStatus('Network: ' + (status.connected ? 'Connected' : 'Offline'));
            } catch (e) {
                showStatus('Network: ' + (navigator.onLine ? 'Online' : 'Offline'));
            }
        }

        // Get safe area insets
        async function getSafeArea() {
            showStatus('Getting safe area...');

            try {
                const insets = await craft.invoke('getSafeArea');
                showStatus(`Safe Area: T=${insets.top} B=${insets.bottom} L=${insets.left} R=${insets.right}`);
            } catch (e) {
                // Use CSS env() values
                const style = getComputedStyle(document.documentElement);
                showStatus('Safe Area: Using CSS env() values');
            }
        }

        // Show status message
        function showStatus(message) {
            const status = document.getElementById('status');
            const statusText = document.getElementById('status-text');
            statusText.textContent = message;
            status.style.display = 'flex';

            // Auto-hide after 3 seconds
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            getPlatformInfo();

            // Listen for native events
            window.addEventListener('craft:ready', function(e) {
                console.log('Craft native bridge is ready');
                showStatus('Native bridge ready!');
            });

            window.addEventListener('craft:background', function(e) {
                console.log('App went to background');
            });

            window.addEventListener('craft:foreground', function(e) {
                console.log('App came to foreground');
            });
        });
    </script>
</body>
</html>
